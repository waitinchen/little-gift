# 用戶認證規格

## 目的
定義用戶註冊、登入、認證和權限管理的完整流程。

## 需求

### 需求：用戶註冊
系統必須允許新用戶創建帳號。

#### 場景：成功註冊
- 當用戶提供有效的電子郵件和密碼
- 且電子郵件格式正確
- 且密碼長度至少 6 位
- 則系統創建新用戶帳號
- 並返回 JWT 認證令牌

#### 場景：註冊失敗 - 電子郵件已存在
- 當用戶提供已存在的電子郵件
- 則系統返回錯誤訊息「用戶郵箱已存在」

#### 場景：註冊失敗 - 密碼太弱
- 當用戶提供少於 6 位的密碼
- 則系統返回錯誤訊息「密碼長度至少6位」

### 需求：用戶登入
系統必須驗證用戶憑證並發放認證令牌。

#### 場景：成功登入
- 當用戶提供正確的電子郵件和密碼
- 且帳號狀態為活躍
- 則系統返回 JWT 令牌和用戶信息
- 並更新最後登入時間

#### 場景：登入失敗 - 憑證錯誤
- 當用戶提供錯誤的電子郵件或密碼
- 則系統返回錯誤訊息「用戶不存在」或「密碼錯誤」

#### 場景：登入失敗 - 帳號被禁用
- 當用戶帳號狀態為非活躍
- 則系統返回錯誤訊息「用戶帳戶已被禁用」

### 需求：JWT 認證
系統必須使用 JWT 令牌進行 API 認證。

#### 場景：有效令牌
- 當請求包含有效的 JWT 令牌
- 則系統允許訪問受保護的資源
- 並將用戶信息添加到請求上下文

#### 場景：無效令牌
- 當請求包含無效或過期的 JWT 令牌
- 則系統返回 401 未授權錯誤

### 需求：角色權限控制
系統必須根據用戶角色限制訪問權限。

#### 場景：管理員權限
- 當用戶角色為 Admin
- 則系統允許訪問所有管理後台功能

#### 場景：客戶權限
- 當用戶角色為 Customer
- 則系統只允許訪問客戶相關功能

## 技術實現

### 數據庫設計
- 用戶表包含：id, email, password_hash, role, is_active 等字段
- 支持角色：customer, recipient, admin, guest

### API 端點
- POST /store/auth/register - 用戶註冊
- POST /store/auth/login - 用戶登入
- GET /store/auth/me - 獲取當前用戶信息
- PUT /store/auth/profile - 更新用戶資料

### 安全措施
- 密碼使用 bcrypt 加密存儲
- JWT 令牌有效期 7 天
- 支持令牌刷新機制
